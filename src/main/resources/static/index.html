<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

    <title>HostelManager</title>
</head>

<body>
    <div class="container">
        <h1>Hostel Manager</h1>
        <div class="btn-group">
            <button id="getGuestsButton" class="btn btn-outline-dark"
                onclick='getRequest("/guests")'>Guests</button>
            <button id="getRoomsButton" class="btn btn-outline-dark"
                onclick='getRequest("/rooms")'>Rooms</button>
            <button id="getBookingsButton" class="btn btn-outline-dark"
                onclick='getRequest("/bookings")'>Bookings</button>
        </div>
        <table class="table table-hover" id="responseArea"></table>
        <div class="row">
            <div class="col">
                <h2>Add Guest</h2>
                <form name="guestForm" id="guestForm">
                    <div class="form-group">
                        <label for="guestName">Name:</label>
                        <input id="guestName" type="text" class="form-control" name="name">
                    </div>
                    <div class="form-group">
                        <label for="guestEmail">Email:</label>
                        <input id="guestEmail" type="email" class="form-control" name="email">
                    </div>
                    <div class="form-group">
                        <label for="guestPhoneNumber">Phone Number:</label>
                        <input id="guestPhoneNumber" type="number" class="form-control" name="phoneNumber">
                    </div>
                    <button type="button" class="btn btn-primary" onclick="submitFormRequest('/guests','guestForm')">Submit</button>
                </form>
            </div>
            <div class="col">
                <h2>Add Room</h2>
                <form name="roomForm" id="roomForm">
                    <div class="form-group">
                        <label for="roomName">Name:</label>
                        <input id="roomName" type="text" class="form-control" name="name">
                    </div>
                    <div class="form-group">
                        <label for="roomMaxPeople">Max People:</label>
                        <input id="roomMaxPeople" type="number" class="form-control" name="maxPeople">
                    </div>
                    <div class="form-group">
                        <label for="roomPrice">Price:</label>
                        <input id="roomPrice" type="number" class="form-control" name="price">
                    </div>
                    <button type="button" class="btn btn-primary" onclick="submitFormRequest('/rooms','roomForm')">Submit</button>
                </form>
            </div>
            <div class="col">
                <h2>Add Booking</h2>
                <form name="bookingForm" id="bookingForm">
                    <div class="form-group">
                        <label for="bookingStartDate">Start Date:</label>
                        <input id="bookingStartDate" type="date" class="form-control" name="startDate">
                    </div>
                    <div class="form-group">
                        <label for="bookingEndDate">End Date:</label>
                        <input id="bookingEndDate" type="date" class="form-control" name="endDate">
                    </div>
                    <div class="form-group">
                        <label for="bookingRoomId">Room ID:</label>
                        <input id="bookingRoomId" type="number" class="form-control" name="roomId">
                    </div>
                    <div class="form-group">
                        <label for="bookingGuestId">Guest ID:</label>
                        <input id="bookingGuestId" type="number" class="form-control" name="guestId">
                    </div>
                    <button type="button" class="btn btn-primary" onclick="submitFormRequest('/bookings','bookingForm')">Submit</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        function getRequest(requestAdress) {
            var xmlh = new XMLHttpRequest();
            xmlh.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    displayResult(this);
                }
            };
            xmlh.open("GET", requestAdress, true);
            xmlh.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');
            xmlh.send();
        }

        function postRequest(requestAdress, requestBody) {
            var xmlh = new XMLHttpRequest();
            xmlh.open("POST", requestAdress, true);
            xmlh.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');
            xmlh.send(requestBody);
        }

        function displayResult(response) {
            var responseObject = JSON.parse(response.responseText);
            console.log(responseObject);
            var resultString = '<thead class="thead-light"><tr>';
            for(var key in responseObject[0]){
                resultString+=`<th>${key}</th>`;
            }
            resultString+='</tr></thead><tbody>';
            var objectCounter=0;
            for(var i in responseObject) {
                resultString+='<tr>';
                for(var key in responseObject[i]){
                    if(typeof responseObject[i][key] === 'object'){
                        objectCounter++;
                        resultString+=`<td><p><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#objectData${objectCounter}" aria-expanded="false" aria-controls="objectData${objectCounter}">
                            ${responseObject[i][key].name}
                            </button></p>`;
                        resultString+=`<div id="objectData${objectCounter}" class="collapse">`;
                        resultString+='<div class="card card-body">';
                        for(var innerKey in responseObject[i][key]){
                            resultString+=`<p><strong>${innerKey}:</strong> <small>${responseObject[i][key][innerKey]}</small></p>`;
                        }
                        resultString+="</div></div></td>";
                    }
                    else {
                        resultString+=`<td>${responseObject[i][key]}</td>`;
                    }
                }
                resultString+='</tr>';
            }
            resultString+='</tbody>';
            document.getElementById("responseArea").innerHTML = resultString;            
        }

        function submitFormRequest(requestAdress, formName){
            var form = document.getElementById(formName);
            var data = new FormData(form);
            var payload = {};
            data.forEach((value, key) => {payload[key] = value});
            form.reset();
            var payloadJSON = JSON.stringify(payload);
            postRequest(requestAdress, payloadJSON);
        }
    </script>
</body>

</html>